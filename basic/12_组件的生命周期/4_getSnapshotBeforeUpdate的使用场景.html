<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4_getSnapshotBeforeUpdate的使用场景(新)</title>
  <!-- 给list创建样式，背景色、要出滚动条overflow auto -->
</head>
<style> 
  .list {
    height: 180px;
    width: 200px;
    border: 1px solid #229081;
    padding: 0;
    overflow: auto;
  }
  li {
    height: 30px;
    line-height: 30px;
    background: #FFEA99;
    color: #AA5500;
    list-style: none;
  }
</style>
<body>
  <div id="test"></div>
  <!-- 创建一个list -->
  <!-- 引入 react_development.js   react-dom.development.js  babel.min.js -->
  <script src="../js/17.0.1/react.development.js"></script>
  <script src="../js/17.0.1/react-dom.development.js"></script>
  <script src="../js/17.0.1/babel.min.js"></script>
  <script type="text/babel">
    // 用js代码让列表里如果让第二条或者第三条顶头
    // 或者list元素，设定list的scrollTop值
    // list元素内容区的高度 scrollHeight (list列表总长度的高度)

    // 创建NewList类，render之前html里的list元素，
    // 元素挂载的钩子里  每秒增加一条列表项  render的元素遍历列表数组  这时如果把滚动条滑动到最下方，滚动条会不停地滚动，用getSnapshotBeforeUpdate钩子解决这个问题
    // getSnapshotBeforeUpdate钩子中，获取一下内容区的高度并return  也就是list的scrollHeight  render后会传给componentDidUpdate
    // componentDidUpdate钩子中动态调整list的scrollTop，
    class NewsList extends React.Component {
      state = {
        timer: null,
        newsArray: []
      }
      render() {
        return <div>
          <ul className="list" ref="list">
            {
              this.state.newsArray.map((element, index) => {
                return <li key={index}>{ element }</li>
              })
            }
          </ul>
        </div>
      }
      getList = () => {
        let { newsArray } = this.state
        let timer = setInterval(() => {
          newsArray.unshift(`新闻${newsArray.length + 1}`)
          this.setState({
            newsArray,
          })
        }, 1500);
        this.setState({
          timer,
        })
      }
      getSnapshotBeforeUpdate() {
        console.log('getSnapshotBefoerUpdate')
        let { list } = this.refs
        return { scrollHeight: list.scrollHeight }
      }
      componentDidUpdate(preProps, preState, snapshot) {
        console.log('componentDidUpdate', preProps, preState, snapshot)
        let { scrollHeight } = snapshot
        let { newsArray } = preState
        let length = newsArray.length
        let { list } = this.refs
        list.scrollTop += list.scrollHeight - scrollHeight
      }
      componentDidMount() {
        this.getList()
      }
      componentWillUnmount() {
        clearInterval(this.state.timer)
      }
    }
    ReactDOM.render(<NewsList />, document.getElementById('test'))

  </script>
</body>
</html>